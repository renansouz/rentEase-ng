<div class="p-4">
  @if (loading()) {
  <div class="flex justify-center py-8">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>
  } @else {

  <form [formGroup]="filterForm" class="flex flex-wrap gap-4 mb-4">
    <mat-form-field appearance="outline" class="flex-1 min-w-[200px]">
      <mat-label>City</mat-label>
      <mat-select formControlName="city">
        <mat-option value="">All</mat-option>
        <mat-option *ngFor="let c of cityOptions" [value]="c">
          {{ c }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="flex-1 min-w-[200px]">
      <mat-label>Price Range</mat-label>
      <div class="px-2">
        <mat-slider
          formControlName="price"
          [min]="minPrice"
          [max]="maxPrice"
          [step]="10"
          thumbLabel
          tickInterval="auto"
          range
        ></mat-slider>
      </div>
    </mat-form-field>

    <mat-form-field appearance="outline" class="flex-1 min-w-[200px]">
      <mat-label>Area (sqm)</mat-label>
      <div class="px-2">
        <mat-slider
          formControlName="area"
          [min]="minArea"
          [max]="maxArea"
          [step]="1"
          thumbLabel
          tickInterval="auto"
          range
        ></mat-slider>
      </div>
    </mat-form-field>

    <mat-form-field appearance="outline" class="flex-1 min-w-[200px]">
      <mat-label>Sort By</mat-label>
      <mat-select formControlName="sortBy">
        <mat-option value="city">City</mat-option>
        <mat-option value="rentPrice">Price</mat-option>
        <mat-option value="areaSize">Area size</mat-option>
      </mat-select>
    </mat-form-field>
  </form>

  @if (flatsSignal().length > 0) {
  <table mat-table [dataSource]="flatsSignal()" class="w-full">
    <ng-container matColumnDef="city">
      <th mat-header-cell *matHeaderCellDef>City</th>
      <td mat-cell *matCellDef="let flat">{{ flat.city }}</td>
    </ng-container>

    <ng-container matColumnDef="rentPrice">
      <th mat-header-cell *matHeaderCellDef>Rent</th>
      <td mat-cell *matCellDef="let flat">${{ flat.rentPrice }}</td>
    </ng-container>

    <ng-container matColumnDef="areaSize">
      <th mat-header-cell *matHeaderCellDef>Area</th>
      <td mat-cell *matCellDef="let flat">{{ flat.areaSize }} sqm</td>
    </ng-container>

    <ng-container matColumnDef="owner">
      <th mat-header-cell *matHeaderCellDef>Owner</th>
      <td mat-cell *matCellDef="let flat">
        <span matTooltip="{{ flat.ownerUID }}">{{ flat.ownerUID }}</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let flat">
        <button mat-icon-button (click)="viewFlat(flat.id)" matTooltip="View">
          <mat-icon>visibility</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="toggleFavorite(flat.id)"
          matTooltip="Toggle Favorite"
        >
          <mat-icon>{{
            isFavorite(flat.id) ? "favorite" : "favorite_border"
          }}</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayColumns"></tr>
  </table>
  } @else {
  <div class="text-center text-gray-600 mt-8">
    <p class="text-lg font-medium">No flats available</p>
    <p class="mt-2">
      There are currently no listings to display. Please check back later or add
      a new flat.
    </p>
  </div>
  } }
</div>
